<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/6.1.0/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/6.1.0/firebase-auth.js"></script>
    <script defer src="/__/firebase/6.1.0/firebase-firestore.js"></script>
    <script defer src="/__/firebase/6.1.0/firebase-functions.js"></script>
    <script defer src="/__/firebase/6.1.0/firebase-storage.js"></script>
    <!-- initialize the SDK after all desired features are loaded -->
    <script defer src="/__/firebase/init.js"></script>
</head>
<body>
<div id="message">
    <p>o_auth_redirect</p>
</div>
<script>
    // See https://stackoverflow.com/a/13419367/1872674
    function parseQuery(queryString) {
        var query = {};
        var pairs = (queryString[0] === '?' ? queryString.substr(1) : queryString).split('&');
        for (var i = 0; i < pairs.length; i++) {
            var pair = pairs[i].split('=');
            query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
        }
        return query;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const query = parseQuery(window.location.search);
        console.log(query);

        // For development
        firebase.functions().useFunctionsEmulator('http://localhost:5001');

        const signInLineCallback = firebase.functions().httpsCallable('lineCallback');
        signInLineCallback({code: query.code, state: query.state}).then((result) => {
            console.log('successful');
        });
    });
</script>
</body>
</html>
